// DO NOT MODIFY THIS FILE
// It was generated by Hyper/J(tm) for debugging purposes only
// To modify the program, edit the source files noted in comments below

package feature.history;

// Stub code generated by Hyper/J(tm). Use <step into> to reach actual methods.
//package feature.history;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.PrintStream;
import java.util.Calendar;

import application.common.TextMessage;

/**
 * A chat history logging class. Log is written to set file or to standard
 * output if no file was specified.
 */
public class HistoryImpl {
	
	public static HistoryImpl instance = new HistoryImpl();

	private FileOutputStream logFileStream = null;
	private PrintStream logFilePrintStream = null;

	public HistoryImpl() {
	}

	public void setFile(File logFile) {
		if (logFileStream != null) {
			try {
				logFileStream.close();
			} catch (IOException e) {
				System.out.println("WARNING: Can not close previous log file.");
			}
		}

		try {
			logFileStream = new FileOutputStream(logFile);
			logFilePrintStream = new PrintStream(logFileStream);
		} catch (FileNotFoundException e) {
			System.out.println("Failed to open log file.");
			e.printStackTrace();
		}
	}

	public PrintStream out() {
		if (logFilePrintStream == null)
			logFilePrintStream = System.out;

		return logFilePrintStream;
	}

	public void logTextMessage(TextMessage msg) {
		StringBuffer sb = new StringBuffer();
		sb.append(Calendar.getInstance().getTime().toString());
		sb.append("  ");
		
		sb.append("CONTENT: ");
		sb.append(msg.getContent());
		
		out().println(sb.toString());
	}

}
